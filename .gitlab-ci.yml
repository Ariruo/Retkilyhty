stages:
  - build_and_push

variables:
  DOCKER_HUB_BACKEND_REPO: "ariru/trailtorchbackend"
  DOCKER_HUB_FRONTEND_REPO: "ariru/trailtorchfrontend"
  DOCKER_BACKEND_TAG: "backend"
  DOCKER_FRONTEND_TAG: "frontend"

build_and_push:
  stage: build_and_push
  image: docker:stable  # Use Docker image to run DinD
  services:
    - docker:dind  # Enable DinD service
  script:
    # Build and push backend
    - docker build -t $DOCKER_HUB_BACKEND_REPO:$DOCKER_BACKEND_TAG -f path/to/your/backend/Dockerfile .
    - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    - docker push $DOCKER_HUB_BACKEND_REPO:$DOCKER_BACKEND_TAG

    # Build and push frontend
    - docker build -t $DOCKER_HUB_FRONTEND_REPO:$DOCKER_FRONTEND_TAG -f path/to/your/frontend/Dockerfile .
    - docker push $DOCKER_HUB_FRONTEND_REPO:$DOCKER_FRONTEND_TAG
  only:
    - main  # Trigger this pipeline only for changes in the main branch
